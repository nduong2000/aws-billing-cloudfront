graph TB
    %% User Layer
    subgraph "User Layer"
        User[ğŸ‘¤ End User<br/>Medical Staff]
        Admin[ğŸ‘¨â€ğŸ’¼ System Admin]
    end

    %% Frontend Infrastructure
    subgraph "Frontend Infrastructure (AWS)"
        CF[â˜ï¸ CloudFront<br/>d27z0qz3ducsem.cloudfront.net]
        S3[ğŸª£ S3 Bucket<br/>medical-billing-frontend-v2-20250526]
        Route53[ğŸŒ Route 53<br/>DNS Management]
    end

    %% Frontend Application
    subgraph "React Frontend Application"
        ReactApp[âš›ï¸ React SPA<br/>Medical Billing UI]
        Router[ğŸ›£ï¸ React Router<br/>Client-side Routing]

        subgraph "Core Pages"
            HomePage[ğŸ  Home Dashboard]
            PatientsPage[ğŸ‘¥ Patient Management]
            ProvidersPage[ğŸ¥ Provider Management]
            ClaimsPage[ğŸ“‹ Claims Processing]
            AuditPage[ğŸ” AI Audit System]
        end

        subgraph "Form Pages"
            PatientForms[ğŸ“ Patient Forms]
            ClaimForms[ğŸ“ Claim Forms]
            AppointmentForms[ğŸ“ Appointment Forms]
        end
    end

    %% API Gateway Layer
    subgraph "API Layer"
        ALB[âš–ï¸ Application Load Balancer]
        APIGateway[ğŸšª API Gateway<br/>REST Endpoints]
    end

    %% Backend Infrastructure
    subgraph "Backend Infrastructure (AWS)"
        Lambda[ğŸš€ AWS Lambda<br/>Python FastAPI Container]
        ECR[ğŸ“¦ Amazon ECR<br/>Container Registry]
        CloudWatch[ğŸ“Š CloudWatch<br/>Logs & Monitoring]
    end

    %% Backend Application
    subgraph "FastAPI Backend Application"
        FastAPI[âš¡ FastAPI App<br/>Medical Billing API]

        subgraph "API Routes"
            PatientAPI[ğŸ‘¥ /api/patients]
            ProviderAPI[ğŸ¥ /api/providers]
            ClaimAPI[ğŸ“‹ /api/claims]
            PaymentAPI[ğŸ’³ /api/payments]
            AuditAPI[ğŸ” /api/audit]
            OllamaAPI[ğŸ¤– /api/ollama]
        end

        subgraph "Core Services"
            AuthService[ğŸ” Authentication]
            ValidationService[âœ… Data Validation]
            BusinessLogic[ğŸ§  Business Logic]
        end
    end

    %% Database Layer
    subgraph "Database Layer"
        PostgreSQL[(ğŸ˜ PostgreSQL<br/>Primary Database)]

        subgraph "Database Tables"
            PatientsDB[ğŸ‘¥ patients]
            ProvidersDB[ğŸ¥ providers]
            ClaimsDB[ğŸ“‹ claims]
            PaymentsDB[ğŸ’³ payments]
            AuditDB[ğŸ” audit_logs]
        end
    end

    %% AI Services
    subgraph "AI & ML Services"
        Ollama[ğŸ¤– Ollama LLM<br/>Local AI Server]
        Bedrock[ğŸ§  AWS Bedrock<br/>Claude/GPT Models]
        FraudDetection[ğŸš¨ Fraud Detection<br/>Pattern Analysis]
    end

    %% External Services
    subgraph "External Integrations"
        InsuranceAPIs[ğŸ¢ Insurance APIs<br/>Eligibility & Claims]
        PaymentGateways[ğŸ’° Payment Gateways<br/>Stripe/Square]
        HL7[ğŸ“¡ HL7 FHIR<br/>Healthcare Standards]
    end

    %% CI/CD Pipeline
    subgraph "CI/CD Pipeline"
        GitHubFE[ğŸ“š Frontend Repo<br/>aws-billing-cloudfront]
        GitHubBE[ğŸ“š Backend Repo<br/>aws-billing-backend-lambda]
        ActionsFE[âš™ï¸ Frontend Actions<br/>Build & Deploy to S3]
        ActionsBE[âš™ï¸ Backend Actions<br/>Build & Deploy to Lambda]
    end

    %% User Flow
    User --> CF
    Admin --> CF
    CF --> S3
    S3 --> ReactApp
    ReactApp --> Router
    Router --> HomePage
    Router --> PatientsPage
    Router --> ProvidersPage
    Router --> ClaimsPage
    Router --> AuditPage

    %% Frontend to Backend Communication
    ReactApp --> ALB
    ALB --> Lambda
    Lambda --> FastAPI

    %% API Routing
    FastAPI --> PatientAPI
    FastAPI --> ProviderAPI
    FastAPI --> ClaimAPI
    FastAPI --> PaymentAPI
    FastAPI --> AuditAPI
    FastAPI --> OllamaAPI

    %% Backend to Database
    PatientAPI --> PostgreSQL
    ProviderAPI --> PostgreSQL
    ClaimAPI --> PostgreSQL
    PaymentAPI --> PostgreSQL
    AuditAPI --> PostgreSQL

    %% Database Tables
    PostgreSQL --> PatientsDB
    PostgreSQL --> ProvidersDB
    PostgreSQL --> ClaimsDB
    PostgreSQL --> PaymentsDB
    PostgreSQL --> AuditDB

    %% AI Integration
    AuditAPI --> Ollama
    AuditAPI --> Bedrock
    ClaimAPI --> FraudDetection

    %% External Integrations
    ClaimAPI --> InsuranceAPIs
    PaymentAPI --> PaymentGateways
    PatientAPI --> HL7

    %% CI/CD Flow
    GitHubFE --> ActionsFE
    GitHubBE --> ActionsBE
    ActionsFE --> S3
    ActionsBE --> ECR
    ECR --> Lambda

    %% Monitoring
    Lambda --> CloudWatch
    FastAPI --> CloudWatch

    %% Styling
    classDef user fill:#9c27b0,stroke:#4a148c,stroke-width:2px,color:#fff
    classDef aws fill:#ff9900,stroke:#232f3e,stroke-width:2px,color:#fff
    classDef react fill:#61dafb,stroke:#20232a,stroke-width:2px,color:#20232a
    classDef api fill:#4caf50,stroke:#2e7d32,stroke-width:2px,color:#fff
    classDef python fill:#3776ab,stroke:#ffd43b,stroke-width:2px,color:#fff
    classDef database fill:#336791,stroke:#ffffff,stroke-width:2px,color:#fff
    classDef ai fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#fff
    classDef external fill:#795548,stroke:#3e2723,stroke-width:2px,color:#fff
    classDef cicd fill:#2196f3,stroke:#0d47a1,stroke-width:2px,color:#fff
    classDef monitoring fill:#ff9800,stroke:#e65100,stroke-width:2px,color:#fff

    class User,Admin user
    class CF,S3,Route53,ALB,APIGateway,Lambda,ECR,CloudWatch aws
    class ReactApp,Router,HomePage,PatientsPage,ProvidersPage,ClaimsPage,AuditPage,PatientForms,ClaimForms,AppointmentForms react
    class FastAPI,PatientAPI,ProviderAPI,ClaimAPI,PaymentAPI,AuditAPI,OllamaAPI,AuthService,ValidationService,BusinessLogic python
    class PostgreSQL,PatientsDB,ProvidersDB,ClaimsDB,PaymentsDB,AuditDB database
    class Ollama,Bedrock,FraudDetection ai
    class InsuranceAPIs,PaymentGateways,HL7 external
    class GitHubFE,GitHubBE,ActionsFE,ActionsBE cicd